# Invite System - Quick Start

## –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

### –ö–∞–∫ –ø—Ä–∏–≥–ª–∞—Å–∏—Ç—å —É—á–∞—Å—Ç–Ω–∏–∫–∞ –≤ —Å–µ–º—å—é

1. **–û—Ç–∫—Ä–æ–π—Ç–µ –∫–æ–º–∞–Ω–¥—É `/family`**
   ```
   /family
   ```

2. **–ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É "üîó –°–æ–∑–¥–∞—Ç—å –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–µ"**
   - –≠—Ç–∞ –∫–Ω–æ–ø–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–∞ —Ç–æ–ª—å–∫–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞–º —Å–µ–º—å–∏

3. **–í—ã–±–µ—Ä–∏—Ç–µ —Ä–æ–ª—å –¥–ª—è –Ω–æ–≤–æ–≥–æ —É—á–∞—Å—Ç–Ω–∏–∫–∞:**
   - üëë **–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä** - –ø–æ–ª–Ω—ã–π –¥–æ—Å—Ç—É–ø –∫ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—é —Å–µ–º—å–µ–π
   - üë§ **–í–∑—Ä–æ—Å–ª—ã–π** - –º–æ–∂–µ—Ç –≤—ã–ø–æ–ª–Ω—è—Ç—å –∑–∞–¥–∞—á–∏, –Ω–æ –Ω–µ –º–æ–∂–µ—Ç —É–ø—Ä–∞–≤–ª—è—Ç—å —Å–µ–º—å–µ–π
   - üë∂ **–†–µ–±—ë–Ω–æ–∫** - –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–µ –ø—Ä–∞–≤–∞

4. **–ü–æ–ª—É—á–∏—Ç–µ —Å—Å—ã–ª–∫—É-–ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–µ**
   ```
   ‚úÖ –ü—Ä–∏–≥–ª–∞—à–µ–Ω–∏–µ —Å–æ–∑–¥–∞–Ω–æ!
   
   üîó –°—Å—ã–ª–∫–∞ –¥–ª—è –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏—è:
   https://t.me/YourBot?start=invite_ABC12345
   
   üë§ –†–æ–ª—å: –í–∑—Ä–æ—Å–ª—ã–π
   üîë –ö–æ–¥: ABC12345
   ‚è∞ –î–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ 7 –¥–Ω–µ–π
   ```

5. **–û—Ç–ø—Ä–∞–≤—å—Ç–µ —Å—Å—ã–ª–∫—É —á–µ–ª–æ–≤–µ–∫—É**, –∫–æ—Ç–æ—Ä–æ–≥–æ —Ö–æ—Ç–∏—Ç–µ –ø—Ä–∏–≥–ª–∞—Å–∏—Ç—å

### –ö–∞–∫ –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–∏—Ç—å—Å—è –∫ —Å–µ–º—å–µ –ø–æ –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏—é

1. **–ü–µ—Ä–µ–π–¥–∏—Ç–µ –ø–æ —Å—Å—ã–ª–∫–µ-–ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏—é**
   - –û—Ç–∫—Ä–æ–µ—Ç—Å—è Telegram –±–æ—Ç

2. **–ù–∞–∂–º–∏—Ç–µ "Start"**
   - –ë–æ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±—Ä–∞–±–æ—Ç–∞–µ—Ç –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–µ

3. **–ü–æ–ª—É—á–∏—Ç–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ**
   ```
   üéâ –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ —Å–µ–º—å—é!
   
   –í—ã —É—Å–ø–µ—à–Ω–æ –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–∏–ª–∏—Å—å –∫ —Å–µ–º—å–µ "–°–µ–º—å—è –ò–≤–∞–Ω–æ–≤—ã—Ö"
   –í–∞—à–∞ —Ä–æ–ª—å: üë§ –í–∑—Ä–æ—Å–ª—ã–π
   
   –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ /tasks —á—Ç–æ–±—ã –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å –∑–∞–¥–∞—á–∏
   ```

## –î–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤

### –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–∏

```bash
cd src/FamilyTaskManager.Infrastructure
dotnet ef database update --context AppDbContext
```

### –ó–∞–ø—É—Å–∫ —Å–∏—Å—Ç–µ–º—ã

```powershell
.\scripts\start-system.ps1
```

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

```bash
# –ó–∞–ø—É—Å—Ç–∏—Ç—å –≤—Å–µ —Ç–µ—Å—Ç—ã invite-—Å–∏—Å—Ç–µ–º—ã
dotnet test --filter "FullyQualifiedName~Invitation"

# –ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç—ã –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –∫–ª–∞—Å—Å–∞
dotnet test --filter "FullyQualifiedName~CreateInviteCodeHandlerTests"
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤ –ë–î

```sql
-- –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –≤—Å–µ –∞–∫—Ç–∏–≤–Ω—ã–µ –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏—è
SELECT * FROM "Invitations" WHERE "IsActive" = true;

-- –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏—è –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π —Å–µ–º—å–∏
SELECT * FROM "Invitations" WHERE "FamilyId" = 'your-family-id';

-- –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –∏—Å—Ç–µ–∫—à–∏–µ –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏—è
SELECT * FROM "Invitations" WHERE "ExpiresAt" < NOW();
```

## Troubleshooting

### –ü—Ä–æ–±–ª–µ–º–∞: "Invitation has expired"

**–ü—Ä–∏—á–∏–Ω–∞**: –ü—Ä–∏–≥–ª–∞—à–µ–Ω–∏–µ –∏—Å—Ç–µ–∫–ª–æ (–ø—Ä–æ—à–ª–æ –±–æ–ª–µ–µ 7 –¥–Ω–µ–π)

**–†–µ—à–µ–Ω–∏–µ**: –°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤–æ–µ –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–µ

### –ü—Ä–æ–±–ª–µ–º–∞: "User is already a member of this family"

**–ü—Ä–∏—á–∏–Ω–∞**: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É–∂–µ —è–≤–ª—è–µ—Ç—Å—è —á–ª–µ–Ω–æ–º —ç—Ç–æ–π —Å–µ–º—å–∏

**–†–µ—à–µ–Ω–∏–µ**: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–ø–∏—Å–æ–∫ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ —á–µ—Ä–µ–∑ `/family`

### –ü—Ä–æ–±–ª–µ–º–∞: "Only admins can create invite codes"

**–ü—Ä–∏—á–∏–Ω–∞**: –¢–æ–ª—å–∫–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—ã –º–æ–≥—É—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏—è

**–†–µ—à–µ–Ω–∏–µ**: –ü–æ–ø—Ä–æ—Å–∏—Ç–µ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ —Å–µ–º—å–∏ —Å–æ–∑–¥–∞—Ç—å –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–µ

### –ü—Ä–æ–±–ª–µ–º–∞: "Invitation not found"

**–ü—Ä–∏—á–∏–Ω–∞**: –ù–µ–≤–µ—Ä–Ω—ã–π –∫–æ–¥ –∏–ª–∏ –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–µ –±—ã–ª–æ —É–¥–∞–ª–µ–Ω–æ

**–†–µ—à–µ–Ω–∏–µ**: –ó–∞–ø—Ä–æ—Å–∏—Ç–µ –Ω–æ–≤—É—é —Å—Å—ã–ª–∫—É-–ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–µ

## API Reference

### CreateInviteCodeCommand

```csharp
public record CreateInviteCodeCommand(
    Guid FamilyId,           // ID —Å–µ–º—å–∏
    FamilyRole Role,         // –†–æ–ª—å –¥–ª—è –Ω–æ–≤–æ–≥–æ —É—á–∞—Å—Ç–Ω–∏–∫–∞
    Guid CreatedBy,          // ID —Å–æ–∑–¥–∞—Ç–µ–ª—è –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏—è
    int ExpirationDays = 7   // –°—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è –≤ –¥–Ω—è—Ö
) : ICommand<Result<string>>;
```

**–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç**: –£–Ω–∏–∫–∞–ª—å–Ω—ã–π –∫–æ–¥ –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏—è (8 —Å–∏–º–≤–æ–ª–æ–≤)

**–û—à–∏–±–∫–∏**:
- `NotFound` - –°–µ–º—å—è –Ω–µ –Ω–∞–π–¥–µ–Ω–∞
- `Forbidden` - –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ —è–≤–ª—è–µ—Ç—Å—è —á–ª–µ–Ω–æ–º —Å–µ–º—å–∏ –∏–ª–∏ –Ω–µ –∞–¥–º–∏–Ω

### JoinByInviteCodeCommand

```csharp
public record JoinByInviteCodeCommand(
    Guid UserId,    // ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    string Code     // –ö–æ–¥ –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏—è
) : ICommand<Result<Guid>>;
```

**–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç**: ID —Å–æ–∑–¥–∞–Ω–Ω–æ–≥–æ FamilyMember

**–û—à–∏–±–∫–∏**:
- `NotFound` - –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å, –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–µ –∏–ª–∏ —Å–µ–º—å—è –Ω–µ –Ω–∞–π–¥–µ–Ω—ã
- `Error` - –ü—Ä–∏–≥–ª–∞—à–µ–Ω–∏–µ –∏—Å—Ç–µ–∫–ª–æ, –Ω–µ–∞–∫—Ç–∏–≤–Ω–æ –∏–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É–∂–µ —á–ª–µ–Ω —Å–µ–º—å–∏

## –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ BotUsername

–í `appsettings.json`:

```json
{
  "Bot": {
    "BotToken": "your-bot-token",
    "BotUsername": "YourBotUsername"
  }
}
```

–ó–∞—Ç–µ–º –æ–±–Ω–æ–≤–∏—Ç–µ `CallbackQueryHandler.cs`:

```csharp
private readonly BotConfiguration _botConfig;

// –í –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–µ
public CallbackQueryHandler(..., IOptions<BotConfiguration> botConfig)
{
    _botConfig = botConfig.Value;
}

// –í HandleInviteActionAsync
var botUsername = _botConfig.BotUsername;
var inviteLink = $"https://t.me/{botUsername}?start=invite_{inviteCode}";
```

## –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏—è –ø—Ä–æ–≥—Ä–∞–º–º–Ω–æ

```csharp
var command = new CreateInviteCodeCommand(
    familyId: familyId,
    role: FamilyRole.Adult,
    createdBy: adminUserId,
    expirationDays: 14  // 2 –Ω–µ–¥–µ–ª–∏
);

var result = await mediator.Send(command);

if (result.IsSuccess)
{
    var inviteCode = result.Value;
    Console.WriteLine($"Invite code: {inviteCode}");
}
```

### –ü—Ä–∏—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –ø–æ –∫–æ–¥—É –ø—Ä–æ–≥—Ä–∞–º–º–Ω–æ

```csharp
var command = new JoinByInviteCodeCommand(
    userId: newUserId,
    code: "ABC12345"
);

var result = await mediator.Send(command);

if (result.IsSuccess)
{
    var memberId = result.Value;
    Console.WriteLine($"User joined! Member ID: {memberId}");
}
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–∞–ª–∏–¥–Ω–æ—Å—Ç–∏ –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏—è

```csharp
var invitation = await invitationRepository.GetByIdAsync(invitationId);

if (invitation.IsValid())
{
    Console.WriteLine("Invitation is valid");
}
else if (invitation.IsExpired())
{
    Console.WriteLine("Invitation has expired");
}
else if (!invitation.IsActive)
{
    Console.WriteLine("Invitation is not active");
}
```

## –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–æ–¥–∞

- –ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –æ–¥–Ω–æ–∑–Ω–∞—á–Ω—ã–µ —Å–∏–º–≤–æ–ª—ã: `ABCDEFGHJKLMNPQRSTUVWXYZ23456789`
- –ò—Å–∫–ª—é—á–µ–Ω—ã: `0`, `O`, `1`, `I`, `L` (—á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å –ø—É—Ç–∞–Ω–∏—Ü—ã)
- –î–ª–∏–Ω–∞: 8 —Å–∏–º–≤–æ–ª–æ–≤
- –£–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç—å –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç—Å—è –∏–Ω–¥–µ–∫—Å–æ–º –≤ –ë–î

### –û–¥–Ω–æ—Ä–∞–∑–æ–≤–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

–ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–µ–∞–∫—Ç–∏–≤–∏—Ä—É–µ—Ç—Å—è:

```csharp
invitation.Deactivate();
await invitationRepository.UpdateAsync(invitation);
```

### –°—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è

–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é 7 –¥–Ω–µ–π, –Ω–æ –º–æ–∂–Ω–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å:

```csharp
// –ü—Ä–∏–≥–ª–∞—à–µ–Ω–∏–µ –Ω–∞ 1 –¥–µ–Ω—å
new Invitation(familyId, role, createdBy, expirationDays: 1);

// –ü—Ä–∏–≥–ª–∞—à–µ–Ω–∏–µ –±–µ–∑ —Å—Ä–æ–∫–∞ –¥–µ–π—Å—Ç–≤–∏—è
new Invitation(familyId, role, createdBy, expirationDays: 0);
```
